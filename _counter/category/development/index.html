<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta name="author" content="Michal Zimmermann">
  <meta name="description" content="Pieces of knowledge from the world of GIS." />
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Michal Zimmermann  &mdash; Category: development </title>
  <link rel="stylesheet" type="text/css" href="/posts/css/style.min.css" />
  <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed:400,700' rel='stylesheet' type='text/css'>
  <script src="/posts/js/highlight.pack.js" defer></script>
  <script>
    window.onload = function() {
      var pre = document.getElementsByTagName('pre');
      for (var i = 0; i < pre.length; i += 1) {
        hljs.highlightBlock(pre[i].firstChild);
      }
    }
  </script>
</head>
<body>
    <div id="main" class="container">
        <div class="row">
            <header role="banner">
                <hgroup>
                    <h1><a href="/posts/">Michal Zimmermann</a></h1>
                    <strong>Pieces of knowledge from the world of GIS.</strong>
                </hgroup>
            </header>
            <nav role="navigation">
                <ul class="nav nav-pills main-navigation">
                    <li><a href="/posts/">Home</a></li>
                    <li><a href="/posts/categories/">Categories</a></li>
                    <li><a href="/posts/tags/">Tags</a></li>
                    <li><a href="/posts/feed.xml/">RSS</a></li>
                </ul>
            </nav>
        </div>
        <div class="shadow">
            <div class="row white">
                <div id="content">
                    <div class="blog-index">
                                                                        <h1>Posts in category development</h1>
                                                  <section>
		<article>
	<header>
	<h2><a href="/posts/2015/hosting-website-on-openshift/">Hosting Website On Openshift</a></h2>
	<small>Written on Feb 23, 2015
		and marked as
		<a href="/posts/tag/openshift/">openshift</a>				| <a href="/posts/category/development/">development</a>
		</small>
	</header>
	<section>
	<p>I decided to migrate <a href="http://www.zimmi.cz">my web</a> to <a href="http://openshift.com">OpenShift</a>. It was a bit frustrating but I got it working eventually.</p>
<h2>Things to know before taking the leap</h2>
<p>Some domain providers don&#8217;t support CNAME changes for root domains (zimmi.cz in my case). This means you can&#8217;t simply tell your domain to serve content from OpenShift address. But what you can do is to tell your <code>www</code> subdomain to do so:</p>
<pre><code>www.zimmi.cz CNAME hp-zimmi.rhcloud.com
</code></pre>
<p>Which is great until you realize you&#8217;ve just created two different websites. That&#8217;s where <a href="http://wwwizer.com/">wwwizer</a> lends you a hand and lets you redirect your naked domain to your <code>www</code> domain:</p>
<pre><code>zimmi.cz A 174.129.25.170
</code></pre>
<p>Now everything works fine and you have your <code>www.domain.tld</code> up and running.</p>
<h2>OpenShift subdomains</h2>
<p>I wasn&#8217;t successful creating a subdomain on the same application where I run my domain. This can be easily solved by creating another application and pointing DNS to it:</p>
<pre><code>posts.zimmi.cz A 174.179.25.170
www.posts.zimmi.cz CNAME posts-zimmi.rhcloud.com
</code></pre>
<p>Just don&#8217;t forget to handle both naked and <code>www</code> version. When Google reindexes new URLs (http://www.zimmi.cz/posts instead of http://posts.zimmi.cz) subdomain application might be deleted.</p>
	</section>
</article>		<article>
	<header>
	<h2><a href="/posts/2015/leaflet-with-custom-crs-epsg-5514/">Leaflet With Custom CRS (EPSG:5514)</a></h2>
	<small>Written on Jan 15, 2015
		and marked as
		<a href="/posts/tag/javascript/">javascript</a>, 		<a href="/posts/tag/leaflet/">leaflet</a>				| <a href="/posts/category/development/">development</a>
		</small>
	</header>
	<section>
	<p>If you ever find yourself in need to use custom projection with Leaflet, feel free to start with this example of <a href="https://github.com/zimmicz/leaflet-custom-crs-jtsk">Czech national coordinate system</a>. All you need is <a href="http://leafletjs.com">Leaflet</a>, <a href="http://proj4js.org/">proj4.js</a> and <a href="https://github.com/kartena/Proj4Leaflet">proj4 for Leaflet plugin</a>. I&#8217;m still not sure how <code>origin</code> coordinates work though.</p>
	</section>
</article>		<article>
	<header>
	<h2><a href="/posts/2014/bash-prepend-to-filename/">Bash: Prepend To Filename</a></h2>
	<small>Written on Nov 01, 2014
		and marked as
		<a href="/posts/tag/linux/">linux</a>, 		<a href="/posts/tag/bash/">bash</a>				| <a href="/posts/category/development/">development</a>
		</small>
	</header>
	<section>
	<pre><code>for f in *; do mv "$f" "prepend_$f"; done
</code></pre>
<p>Whenever you need to prepend anything to your files.</p>
	</section>
</article>		<article>
	<header>
	<h2><a href="/posts/2014/migrating-geoserver-and-checking-for-missing-data/">Migrating Geoserver And Checking For Missing Data</a></h2>
	<small>Written on Oct 29, 2014
		and marked as
		<a href="/posts/tag/geoserver/">geoserver</a>, 		<a href="/posts/tag/python/">python</a>				| <a href="/posts/category/development/">development</a>
		</small>
	</header>
	<section>
	<p>I&#8217;ve upgraded a handful of Geoserver installations and it has never been flawless. If you&#8217;re lucky you end up with just <em>some</em> layers missing, if you&#8217;re not, you&#8217;ll miss a bunch of them (together with layergroups, some stores, workspaces might screw up etc.).</p>
<p>But how do you check for missing data before switching to the newer version? Thanks to the <a href="http://docs.geoserver.org/stable/en/user/rest/api/index.html">REST API implemented within Geoserver</a>, it&#8217;s rather easy.</p>
<pre><code>import requests
from bs4 import BeautifulSoup
from requests.auth import HTTPBasicAuth

req = requests.get('http://example.com/geoserver/rest/layers', auth=HTTPBasicAuth('username', 'password'))

html = BeautifulSoup(req.text)
i = 0
for link in html.find_all('a'):
    i += 1
    href = link.get_text()
    print i

with open('list.txt', 'a') as f:
        f.write(href)
        f.write('\n')
</code></pre>
<p>We needed to migrate ~ 17,000 layers last week, and yes, we could have just shut the door and spend couple of nights checking one after another, if we were the dumbest GIS company ever.</p>
<p>As I wanted to make it a bit easier I wrote the simple Python script (see above) that just authenticates against Geoserver and downloads the list of layers. I actually had to do that twice - both old and new instance. A <a href="https://www.diffchecker.com/">simple file comparison</a> followed and I got a list of missing layers in less than two minutes.</p>
<p>If you do the same to workspaces, stores and layergroups, your chances of not losing some data after the switch are pretty high.</p>
<p>I guess it&#8217;s reasonable to check your maps by hand as well, but this gives you the picture of the current state of your data real quick.</p>
	</section>
</article>		<article>
	<header>
	<h2><a href="/posts/2014/ogr2ogr-unix-x-windows/">ogr2ogr UNIX x Windows</a></h2>
	<small>Written on Sep 23, 2014
		and marked as
		<a href="/posts/tag/spatial/">spatial</a>, 		<a href="/posts/tag/linux/">linux</a>				| <a href="/posts/category/development/">development</a>
		</small>
	</header>
	<section>
	<p>GDAL with its ogr2ogr, ogrinfo and many more is one of the best open source tools to do anything to your spatial data. It is a&nbsp;command line tool, which sort of determines it to be used with UNIX systems, but you might bump into a Windows guy trying to use it as well once in a while.</p>
<p>Be careful, it behaves differently on different OS. Let&#8217;s say you do something like this on UNIX:</p>
<pre><code>ogr2ogr -f GeoJSON -where "attribute IN ('value1', 'value2')" output.json input.json
</code></pre>
<p>What you <abbr title="But you might get expected result as well">might get is a big nothing</abbr>. Executed on Windows it gives you the result you&#8217;ve expected. <em>Aargh</em>, what is that supposed to mean?</p>
<p>Well, that&#8217;s the ogr2ogr&#8217;s way to tell you: <em>Hello there, you need to switch single quotes for double quotes and vice versa, you dumb!</em> I don&#8217;t know why and I find it really annoying. Just in case you get stuck with ogr2ogr (or probably any other command line tool), try this.</p>
	</section>
</article>		<article>
	<header>
	<h2><a href="/posts/2014/notify-when-average-of-10-subsequent-numbers-is-bigger-than-given-value/">Notify When Average of 10 Subsequent Numbers Is Bigger Than Given Value</a></h2>
	<small>Written on Sep 21, 2014
		and marked as
		<a href="/posts/tag/php/">php</a>				| <a href="/posts/category/development/">development</a>
		</small>
	</header>
	<section>
	<p>I found an <a href="http://stackoverflow.com/questions/25952380/php-find-a-maximum-average-for-10-subsequent-numbers-in-a-list-of-50-random-numb">interesting question</a> at StackOverflow asking for help finding solution to what I have already mentioned in the title, with PHP. I gave it a try before reading answers and came up with the following code:</p>
<pre><code>$avg  = // value we are looking for
$size = count($numbers);

for ($i = 0; $i &lt; $size; $i += 1) {
    if ($i + 9 &lt; 51) {
        $val += $numbers[$i];
        for ($j = $i + 1; $j &lt; 10 + $i; $j += 1) {
            $val += $numbers[$j];
        }
        if ($val / 10 &gt;= $avg) { // hit
            // do something
        }
        $val = 0;
    }
}
</code></pre>
<p>That was the first that I could think of. And it worked. The answer given by Dave Chen was much more elegant than my solution (although I think it does something a bit different, but that&#8217;s not the point here):</p>
<pre><code>$number = 10; //numbers in a set
$max = 0;
$index = 0;

$size = sizeof($numbers) - $number;
for ($i = 0; $i &lt; $size; $i++) {
    $tmp = array_sum(array_slice($numbers, $i, $number)) / $number;
    if ($tmp &gt; $max) {
        $max = $tmp;
        $index = $i;
    }
}
</code></pre>
<p>I made a simple benchmark with <a href="http://php.net/manual/en/function.microtime.php"><code>microtime()</code></a> and found out that my solution (ran 100k times) took about ~12.3 seconds while Dave&#8217;s took only ~7.4 seconds to finish. That makes his code almost twice faster than mine.</p>
<p><strong>Lesson learned: do not stop learning!</strong></p>
	</section>
</article>		<article>
	<header>
	<h2><a href="/posts/2014/postgresql-remote-access/">PostgreSQL Remote Access</a></h2>
	<small>Written on Sep 17, 2014
		and marked as
		<a href="/posts/tag/postgresql/">postgresql</a>, 		<a href="/posts/tag/linux/">linux</a>				| <a href="/posts/category/development/">development</a>
		</small>
	</header>
	<section>
	<p>PostgreSQL is set to listen only to connections coming from localhost by default. I guess that&#8217;s fine as far as you don&#8217;t need access to the database from anywhere else (like your work network). If you do, you need to log via SSH or use some online database management tool (go for <a href="http://adminer.org">Adminer</a> and forget about anything called php[pg|my]admin). Or you can set it up to access connections from other locations.</p>
<p>You need to:</p>
<ol>
<li>set <code>listen_addresses</code> to <code>*</code> in your postgres.conf. That does not mean anyone can connect to your database, that means that the server will listen to connections coming from any available IP interface.</li>
<li>insert new entry into pg_hba.conf looking like this: <code>host database user xxx.xxx.xxx.xxx md5</code>. Now we&#8217;re saying we only want connections coming from IP <code>xxx.xxx.xxx.xxx</code> accepted.</li>
<li>
<p>Add rule allowing the database server access to iptables. Number 5 says it will be the fifth rule in the order. It must come before the final REJECT ALL rule if present.</p>
<p><code>iptables -I INPUT 5 -p tcp --dport 5432 -s xxx.xxx.xxx.xxx -j ACCEPT</code>
4. Just to be sure noone else is able to connect, reject all on port 5432.</p>
<p><code>iptables -I INPUT 6 -p tcp --dport 5432 -j REJECT</code></p>
</li>
</ol>
<p>You&#8217;re set to remotely connect to your database server.</p>
	</section>
</article>		<article>
	<header>
	<h2><a href="/posts/2014/switch-latitude-and-longitude-with-regular-expression/">Switch Latitude And Longitude With Regular Expression</a></h2>
	<small>Written on Sep 14, 2014
		and marked as
		<a href="/posts/tag/sublime/">sublime</a>, 		<a href="/posts/tag/regex/">regex</a>				| <a href="/posts/category/development/">development</a>
		</small>
	</header>
	<section>
	<p>It happens that you receive a file with longitude and latitude just in the opposite order that you would like to have. It&#8217;s fairly easy to switch those without loading it into Excel or Calc and doing <code>Ctrl + C</code> and <code>Ctrl + V</code> on columns.</p>
<p>If you have a file with tabular data that looks like this:</p>
<pre><code> 50.52, 60.15
 70.96, 80.1
-55.23, 62.03
</code></pre>
<p>You can use Sublime Text to switch the values:</p>
<ol>
<li>Press <code>Ctrl + H</code></li>
<li>Copy <code>(\-?\d+\.?\d+),?[\t ]*(\-?\d+\.?\d+)$</code> to <em>Find What</em> input</li>
<li>Copy <code>$2,$1</code> to <em>Replace With</em> input</li>
</ol>
<p>Hit <em>Replace All</em> button and you&#8217;re done.</p>
	</section>
</article>		<article>
	<header>
	<h2><a href="/posts/2014/blogging-on-docker-piecrust-to-the-rescue/">Blogging On Docker: Piecrust To The Rescue</a></h2>
	<small>Written on Sep 11, 2014
		and marked as
		<a href="/posts/tag/docker/">docker</a>, 		<a href="/posts/tag/linux/">linux</a>				| <a href="/posts/category/development/">development</a>
		</small>
	</header>
	<section>
	<p>I love blogging. I hate blogging systems. I hate content management systems. I just want to blog. That&#8217;s what <a href="http://bolt80.com/piecrust/">PieCrust</a> is all about - it lets you blog.</p>
<p>It is powerful static website generator perfect for my needs (and for yours as well?). Blogging with PieCrust is really a piece of cake:</p>
<ol>
<li>prepare post</li>
<li>serve site</li>
<li>bake site</li>
<li>send it off to the public</li>
</ol>
<p>I love having clean OS. That&#8217;s what <a href="http://docker.com">Docker</a> is all about - for me. Running PieCrust on Docker is really easy, it does not clutter your PC and it just works.</p>
<p>If you ever want to use PieCrust on Docker, why don&#8217;t you start with this code?
    FROM centos:centos6</p>
<pre><code>RUN rpm -Uvh http://mirror.webtatic.com/yum/el6/latest.rpm
RUN rpm -Uvh http://download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
RUN rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm

RUN yum --enablerepo=remi,remi-php55 install -y php php-mbstring php-opcache php-cli php-pear php-common &amp;&amp; yum clean all
RUN php -r "readfile('https://getcomposer.org/installer');" | php
RUN echo "date.timezone = Europe/Prague" &gt;&gt; /etc/php.ini
RUN mv composer.phar /usr/bin/composer
RUN php -r "eval('?&gt;'.file_get_contents('http://backend.bolt80.com/piecrust/install'));"
RUN mv piecrust.phar /usr/bin/chef

CMD ["/bin/bash"]
</code></pre>
<p>Running <code>sudo docker build --tag=piecrust .</code> will result in having docker container ready to run. Just run <code>sudo docker run -it -p 8080:8080 -v /host_piecrust_path/:/container_path piecrust /bin/bash</code> in terminal. While in container terminal, run <code>chef serve -n -p 8080 -a 0.0.0.0</code> and visit <a href="http://localhost:8080">http://localhost:8080</a>. You should see your PieCrust site up and running.</p>
<p>The last command tells chef to serve your site on port 8080 (which should be free unless you&#8217;re running Tomcat or something like that) and make it listen on every available network interface. If you used 127.0.0.1 instead, you would never reach your site from outside the container.</p>
<p>See? Easy.</p>
	</section>
</article>		<article>
	<header>
	<h2><a href="/posts/2014/degrees-to-decimal-with-javascript/">Degrees To Decimal With Javascript</a></h2>
	<small>Written on Sep 09, 2014
		and marked as
		<a href="/posts/tag/javascript/">javascript</a>				| <a href="/posts/category/development/">development</a>
		</small>
	</header>
	<section>
	<p>I have found a nice way to get decimal value from degrees of longitude and latitude recently:</p>
<pre><code>function format(coords) {
    var decimal = 0,
        output  = [],
        coords  = coords.split('  '); // it might be &lt;br&gt; as well

    for (var i = 0; i &lt; coords.length; i += 1) {
        var c = coords[i].split(' ');

        for (var j = 0; j &lt; c.length; j += 1) {
            decimal += c[j].slice(0, -1) / Math.pow(60, j);
        }

        output.push(parseFloat(decimal).toFixed(5));
        decimal = 0;
    }

    prompt('Souřadnice bodu', output.join(', '));
}
</code></pre>
<p>When you call <code>format("DD° MM' SS'  DD° MM' SS'");</code> you&#8217;ll get decimal value in return (or <code>prompt</code> to be accurate). What I like the most about this solution is the usage of Math.pow(). I think it is a neat way to transform the values as you need to divide parts of latitude or longitude by 60<sup>0</sup>, 60<sup>1</sup> and 60<sup>2</sup> respectively.</p>
<p>There is definitely a googol of different solutions to this task, I just liked the simplicity of this one.</p>
	</section>
</article></section>
                                          </div>
                </div>
            </div>
            <div class="row white">
                <footer role="contentinfo">
                                          
                                              <a class="pagination" href="/posts/category/development/2">Next page &raquo;</a>
                                                              <p>Written by <a href="http://www.zimmi.cz">Michal Zimmermann</a>. Baked with <em><a href="http://bolt80.com/piecrust/">PieCrust</a> 2.0.0a6-6-g0fb1eb8</em>.</p>
                </footer>
            </div>
        </div>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-43432739-2', 'auto');
      ga('send', 'pageview');
    </script>
</body>
</html>