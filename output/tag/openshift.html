<!DOCTYPE html>
<html lang="en">
<head>
        <title>Michal Zimmermann | tag: openshift</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="/feed.xml" type="application/rss+xml" rel="alternate" title="Michal Zimmermann Full RSS Feed" />
        <link rel="stylesheet" href="/theme/webassets-external/51f6d10d6d7b972e72c633cdadf65306_foundation.min.css">
        <link rel="stylesheet" href="/theme/webassets-external/f8c76b8fadad6790f713cf1a3ee1ab20_pygment.css">
        <link rel="stylesheet" href="/theme/webassets-external/852031a1b55a4450770e95aa75e5cf77_screen.css">

</head>

<body id="index" class="home">
    <nav class="top-bar" data-topbar role="navigation">
        <ul class="title-area">
            <li class="name">
                <h1><a href="/posts">Home</a></h1>
            </li>
     <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
            <li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
        </ul>
        <section class="top-bar-section">
    <!-- Right Nav Section -->
            <ul class="right">
                <li><a href="/categories">Categories</a></li>
                <li><a href="/tags">Tags</a></li>
                <li><a href="/feed.xml">RSS feed</a></li>
            </ul>
        </section>
    </nav>
        <div class="row">
          <div class="large-12 columns header">
            <h1><a href="/posts">Michal Zimmermann</a> <small>Pieces of knowledge from the world of GIS.</small></h1>
          </div>
        </div>
        <div class="row">
            <div class="large-12 columns">
<h2 class="text-center">Articles tagged with openshift tag</h2>

    <div class="panel">
        <div class="post-name">
            <h2><a href="/posts/2015/twitter-rest-api-data-mining-on-openshift-part-i/" rel="bookmark" title="Permalink to Twitter REST API Data Mining on OpenShift Part I">Twitter <span class="caps">REST</span> <span class="caps">API</span> Data Mining on OpenShift Part&nbsp;I</a></h2>
            <small>Written on Nov 6, 2015
        and marked as
        <a href="/tag/javascript.html">javascript</a>,         <a href="/tag/openshift.html">openshift</a>,         <a href="/tag/twitter.html">twitter</a>        | <a href="/category/development.html">development</a>
        </small>
        <section>
            <p>More than a year ago I wrote about <a href="http://www.zimmi.cz/posts/2014/analyzing-twitter-languages-with-streaming-api/">analyzing Twitter languages with Streaming <span class="caps">API</span></a>. Back then I kept my laptop running for a week to download data. Not a comfortable way, especially if you decide to get more data. One year uptime doesn&#8217;t sound like anything you want to be part of. <a href="https://www.openshift.com/">OpenShift</a> by Red Hat seems to be almost perfect replacement.&nbsp;Almost.</p>
<h2>OpenShift&nbsp;setup</h2>
<p>I started with Node.js application running on one small gear. Once running, you can easily <code>git push</code> the code to your OpenShift repo and login via <span class="caps">SSH</span>. I quickly found simple copy-pasting my local solution wasn&#8217;t going to work. and fixed it with some minor tweaks. That&#8217;s where the fun&nbsp;begins&#8230;</p>
<blockquote>
<p>I based the downloader on Node.js a year ago. Until now I still don&#8217;t get how that piece of software works. Frankly, I don&#8217;t really care as long as it&nbsp;works.</p>
</blockquote>
<h3>Pitfalls</h3>
<p>If your application doesn&#8217;t generate any traffic, <strong>OpenShift turns it off</strong>. It wakes up once someone visits again. I had no idea about that and spent some time trying to stop that behavior. Obviously, I could have scheduled a cron job on my laptop pinging it every now and then. Luckily, OpenShift can run cron jobs itself. All you need is to embed a cron cartridge into the running application (and install a bunch of ruby dependencies&nbsp;beforehand).</p>
<div class="highlight"><pre>rhc cartridge add cron-1.4 -a app-name
</pre></div>


<p>Then create <code>.openshift/cron/{hourly,daily,weekly,monthly}</code> folder in the git repository and put your script running a simple curl command into one of&nbsp;those.</p>
<div class="highlight"><pre>curl http://social-zimmi.rhcloud.com &gt; /dev/null
</pre></div>


<p>Another problem was just around the corner. Once in a while, the app stopped writing data to the database without saying a word. What helped was restarting it - the only automatic way to do so being a <code>git push</code> command. Sadly, I haven&#8217;t found a way to restart the app from within itself; it probably can&#8217;t be&nbsp;done.</p>
<p>When you <code>git push</code>, the gear stops, builds, deploys and restarts the app. By using hot deployment you can minimize the downtime. Just put the <code>hot_deploy</code> file into <code>.openshift/markers</code> folder.</p>
<div class="highlight"><pre>git commit --allow-empty -m <span class="s2">&quot;Restart gear&quot;</span> <span class="o">&amp;&amp;</span> git push
</pre></div>


<p>This solved the problem until I realize that <strong>every restart deleted all the data</strong> collected so far. If your data are to stay safe and sound, <strong>save them in <code>process.env.OPENSHIFT_DATA_DIR</code></strong> (which is <code>app-root/data</code>).</p>
<h3>Anacron to the&nbsp;rescue</h3>
<p>How do you push an empty commit once a day? With cron of course. Even better, <strong>anacron</strong>.</p>
<div class="highlight"><pre>mkdir ~/.anacron
<span class="nb">cd</span> ~/.anacron
mkdir cron.daily cron.weekly cron.monthly spool etc

cat <span class="s">&lt;&lt;EOT &gt; ~/.anacron/etc/anacrontab</span>

<span class="s">SHELL=/bin/sh</span>
<span class="s">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/$HOME/bin</span>
<span class="s">HOME=$HOME</span>
<span class="s">LOGNAME=$USER</span>

<span class="s">1 5  daily-cron nice run-parts --report $HOME/.anacron/cron.daily</span>
<span class="s">7 10 weekly-cron nice run-parts --report $HOME/.anacron/cron.weekly</span>
<span class="s">@monthly 15 monthly-cron nice run-parts --report $HOME/.anacron/cron.monthly</span>

<span class="s">EOT</span>

cat <span class="s">&lt;&lt;EOT &gt;&gt; ~/.zprofile # I use zsh shell</span>
<span class="s">rm -f $HOME/.anacron/anacron.log</span>
<span class="s">/usr/sbin/anacron -t /home/zimmi/.anacron/etc/anacrontab -S /home/zimmi/.anacron/spool &amp;&gt; /home/zimmi/.anacron/anacron.log</span>

<span class="s">EOT</span>
</pre></div>


<p>Anacron is to laptop what cron is to 24/7 running server. It just runs automatic jobs when the laptop is running. If it&#8217;s not and the job should be run, it runs it once the <span class="caps">OS</span> boots. Brilliant&nbsp;idea.</p>
<p>It runs the following code for me to keep the app writing data to the&nbsp;database.</p>
<div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="nv">workdir</span><span class="o">=</span><span class="s1">&#39;/home/zimmi/documents/zimmi/dizertace/social&#39;</span>
<span class="nv">logfile</span><span class="o">=</span><span class="nv">$workdir</span>/restart-gear.log
date &gt;&gt; <span class="nv">$logfile</span>

<span class="o">{</span> <span class="nb">cd</span> <span class="nv">$workdir</span> <span class="o">&amp;&amp;</span> git merge origin/master <span class="o">&amp;&amp;</span> git commit --allow-empty -m <span class="s2">&quot;Restart gear&quot;</span> <span class="o">&amp;&amp;</span> git push <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;Success&quot;</span> <span class="p">;</span> <span class="o">}</span> &gt;&gt; <span class="nv">$logfile</span> 2&gt;<span class="p">&amp;</span>1
</pre></div>


<p>I&#8217;ve been harvesting Twitter for a month with about 10-15K tweets a day (only interested in the Czech Republic). 
<sup>1</sup>&frasl;<sub>6</sub> to <sup>1</sup>&frasl;<sub>5</sub> of them is located with latitude and longitude. More on this next&nbsp;time.</p>
        </section>
        </div>
    </div>

    <div class="panel">
        <div class="post-name">
            <h2><a href="/posts/2015/hosting-website-on-openshift/" rel="bookmark" title="Permalink to Hosting Website On Openshift">Hosting Website On&nbsp;Openshift</a></h2>
            <small>Written on Feb 23, 2015
        and marked as
        <a href="/tag/openshift.html">openshift</a>        | <a href="/category/development.html">development</a>
        </small>
        <section>
            <p>I decided to migrate <a href="http://www.zimmi.cz">my web</a> to <a href="http://openshift.com">OpenShift</a>. It was a bit frustrating but I got it working&nbsp;eventually.</p>
<h2>Things to know before taking the&nbsp;leap</h2>
<p>Some domain providers don&#8217;t support <span class="caps">CNAME</span> changes for root domains (zimmi.cz in my case). This means you can&#8217;t simply tell your domain to serve content from OpenShift address. But what you can do is to tell your <code>www</code> subdomain to do&nbsp;so:</p>
<div class="highlight"><pre>www.zimmi.cz CNAME hp-zimmi.rhcloud.com
</pre></div>


<p>Which is great until you realize you&#8217;ve just created two different websites. That&#8217;s where <a href="http://wwwizer.com/">wwwizer</a> lends you a hand and lets you redirect your naked domain to your <code>www</code> domain:</p>
<div class="highlight"><pre>zimmi.cz A 174.129.25.170
</pre></div>


<p>Now everything works fine and you have your <code>www.domain.tld</code> up and&nbsp;running.</p>
<h2>OpenShift&nbsp;subdomains</h2>
<p>I wasn&#8217;t successful creating a subdomain on the same application where I run my domain. This can be easily solved by creating another application and pointing <span class="caps">DNS</span> to&nbsp;it:</p>
<div class="highlight"><pre>posts.zimmi.cz A 174.179.25.170
www.posts.zimmi.cz CNAME posts-zimmi.rhcloud.com
</pre></div>


<p>Just don&#8217;t forget to handle both naked and <code>www</code> version. When Google reindexes new URLs (http://www.zimmi.cz/posts instead of http://posts.zimmi.cz) subdomain application might be&nbsp;deleted.</p>
        </section>
        </div>
    </div>

<div class="pagination">
    <p class="paginator">
    </p>
</div>            </div>
        </div>
        <div class="row">
            <div class="large-12 columns footer">
                <footer>
                    <address>
                    Written by <a href="http://www.zimmi.cz">Michal Zimmermann</a>.
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    </address><!-- /#about -->
                </footer><!-- /#contentinfo -->
            </div>
        </div>
<script src="/theme/webassets-external/633f060ebe664637871acbe7f7239dc4_jquery.js"></script>
<script src="/theme/webassets-external/4dac46d0971ad87d95db9a138607198c_foundation.min.js"></script>
<script>
$(document).foundation();
</script>
</body>
</html>